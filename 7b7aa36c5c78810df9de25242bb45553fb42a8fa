{
  "comments": [
    {
      "key": {
        "uuid": "6c2030da_683bcb43",
        "filename": "Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 553,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-03-04T05:45:59Z",
      "side": 1,
      "message": "This \u0027libs\u0027 prevents the stubs lib from embedded into this library. (\u0027static_libs\u0027 is for embedding)",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97485976_1ece6fa6",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1074959
      },
      "writtenOn": "2018-03-04T04:56:27Z",
      "side": 1,
      "message": "Again, this statement is wrong. Today\u0027s version of lite protobuf *requires* sun.misc.Unsafe *and* libcore.io.Memory to function. If they are not present, protobuf will not execute and will cause process death. Please refer to https://cs.corp.google.com/piper///depot/google3/java/com/google/protobuf/MessageSchema.java?q\u003dMessageSchema.java\u0026sq\u003dpackage:piper+file://depot/google3+-file:google3/experimental\u0026l\u003d1 and https://docs.google.com/document/d/1_z6-tIa31Pq6MUi_79eA5S6214J13idRbAHTgn3vqXY/edit#heading\u003dh.zcn0x0ceatz5\n\nI am -2 on this change because I don\u0027t understand the implications of it, coupled with statements like these in the code that demonstrate a misunderstanding of the situation from libcore team.\n\nI suggest that we prioritize a discussion on what the current state is and how we should move forward. I\u0027m on the East Coast US on Monday but I see you are in Korea and Narayan is in London. I have no idea how to properly schedule this...",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70662af7_01f758f6",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-03-04T05:20:34Z",
      "side": 1,
      "message": "Thanks for the prompt response. Yes, I know that upstream protobuf is using both classes (you\u0027ve already explained this in the bug), but when will it be merged here? Right now, here in Android, these are the set of APIs that are used. I think we can add more APIs to this file when the upstream is merged here. This file is exclusive to protobuf... and thus should/can be adjusted by protobuf\u0027s need.\n\nMy main concern is on the mechanism part, and I want to separate the discussion about the mechanism (using stubs lib to provide build-time only info of the private symbols) from the discussion about the policy (the selection of APIs that are exposed here). And I thought you have no objection at least to the mechanism part, don\u0027t you?",
      "parentUuid": "97485976_1ece6fa6",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f1409d03_59377731",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-03-04T05:23:22Z",
      "side": 1,
      "message": "oh, for the meeting, 9am EST is 11pm in KST (2pm in LON) and I am okay with the time, as long as it\u0027s not regular.",
      "parentUuid": "70662af7_01f758f6",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b740249c_959fee02",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1074959
      },
      "writtenOn": "2018-03-04T05:26:24Z",
      "side": 1,
      "message": "I do not know when it will be merged here. I do not own protobuf in Gerrit and I do not even know who uses it to point to them as the owners :) tberghammer@ did the last update IIRC. We\u0027ll open source our code shortly at which point someone can pull it down here and save folks a boat load of binary size.\n\nIs your mechanism to ship this unnecessary class in production? If so, do you have an equivalent to blaze\u0027s \"neverlink\" in AOSP build? I\u0027d use that instead. If not, I have one other concern that requires a VC to discuss.",
      "parentUuid": "70662af7_01f758f6",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c80f6ba_09e7bdc7",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1074959
      },
      "writtenOn": "2018-03-04T05:35:20Z",
      "side": 1,
      "message": "We did a quick VC. It turns out that the comment in this class is outdated and this stub is indeed only used at build time like blaze\u0027s \"neverlink\". This resolves my other concern.\n\nPlease update the comment and resolve this thread. I\u0027m +1 after that. Note that I don\u0027t know how to actually *verify* that this stub is used in that manner - I trust other reviewers can do that.",
      "parentUuid": "b740249c_959fee02",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "019f99f6_cc37182f",
        "filename": "java/core/src/stubs/sun/misc/Unsafe.java",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-03-04T05:45:59Z",
      "side": 1,
      "message": "sure. I just double checked that Unsafe class isn\u0027t included in the protobuf.\n\n$ unzip -l out/soong/.intermediates/external/protobuf/libprotobuf-java-lite/android_common/javac/libprotobuf-java-lite.jar | grep Unsafe.class\n\u003cshows nothing\u003e",
      "parentUuid": "6c80f6ba_09e7bdc7",
      "revId": "7b7aa36c5c78810df9de25242bb45553fb42a8fa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}